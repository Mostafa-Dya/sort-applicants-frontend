<div class="row" style="width: 100%;">
  <div class="col-sm-12">
    <app-card cardTitle="{{ 'Add Public Entity' | translate }}" [options]="false">
      <form [formGroup]="mainForm" (submit)="submit()" action="javascript:">
        <!-- Entity Name -->
        <div class="form-group col-md-12">
          <label for="card_number">
            {{ 'Entity Name' | translate }} <span> *</span>
          </label>
          <input type="text" class="form-control" id="card_number" placeholder="{{ 'Public Entity' | translate }}"
            formControlName="publicEntity" />
        </div>
        <br>

        <!-- Add Sub Entity -->
        <app-card cardTitle="{{ 'Add Sub Entity' | translate }}" [options]="false">
          <div class="col-md-1">
            <i (click)="addSets('subEntity')" class="fa-solid fa-plus"></i>
          </div>
          <div formArrayName="subEntitiesData">
            <!-- Iterate over Sub Entities -->
            <div *ngFor="let set of subEntitiesSets.controls; let i = index" [formGroupName]="i">
              <div class="oneForm row">
                <!-- Sub Entity Name -->
                <div class="form-group col-md-11">
                  <label for="subEntity"></label>
                  <input type="text" class="form-control" id="subEntity" placeholder="{{ 'Sub Entity' | translate }}"
                    formControlName="name" />

                  <!-- Affiliated Entities Section -->
                  <app-card *ngIf="set.get('name').value" cardTitle="{{ 'Add Affiliated Entity' | translate }}"
                    [options]="false">
                    <div class="col-md-1">
                      <i (click)="addAffiliatedEntities(set)" class="fa-solid fa-plus"></i>
                    </div>
                    <div formArrayName="affiliatedEntities">
                      <!-- Iterate over Affiliated Entities -->
                      <div *ngFor="let affSet of getAffiliatedEntitiesControls(set); let j = index" [formGroupName]="j">
                        <div class="oneForm row">
                          <div class="form-group col-md-11">
                            <label for="affEntity"></label>
                            <input type="text" class="form-control" id="affEntity"
                            placeholder="{{ 'Affiliated Entity' | translate }}"
                            formControlName="name" />

                            <!-- Sub Affiliated Entities Section -->
                            <app-card *ngIf="set.get('name').value"
                              cardTitle="{{ 'Add Sub Affiliated Entity' | translate }}" [options]="false">
                              <div class="col-md-1">
                                <i (click)="addSubAffiliatedEntities(set)" class="fa-solid fa-plus"></i>
                              </div>
                              <div formArrayName="subAffiliatedEntities">
                                <!-- Iterate over Sub Affiliated Entities -->
                                <div *ngFor="let subAffSet of getSubAffiliatedEntitiesControls(affSet); let k = index" [formGroupName]="k">
                                  <div class="oneForm row">
                                    <div class="form-group col-md-11">
                                      <label for="subAffEntity"></label>
                                      <input type="text" class="form-control" id="subAffEntity"
                                        placeholder="{{ 'Sub Affiliated Entity' | translate }}"
                                        formControlName="subAffiliatedEntityName" />
                                    </div>
                                    <div class="col-md-1">
                                      <i (click)="removeSubAffiliatedEntities(set, k)"
                                        class="fa-solid fa-minus alignment"></i>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              
                            </app-card>
                          </div>
                          <div class="col-md-1">
                            <i (click)="removeAffiliatedEntities(set, j)" class="fa-solid fa-minus alignment"></i>
                          </div>
                        </div>
                      </div>
                    </div>
                  </app-card>


                </div>
                <!-- Remove Sub Entity Button -->
                <div class="col-md-1">
                  <i (click)="removeSet(i, 'subEntity')" class="fa-solid fa-minus alignment"></i>
                </div>
              </div>
            </div>
          </div>
        </app-card>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary"
          *ngIf="(role === 'Admin' || (role === 'User' && permissions.editPublic === 1))">{{ 'Submit' | translate
          }}</button>
      </form>
    </app-card>
  </div>
</div>